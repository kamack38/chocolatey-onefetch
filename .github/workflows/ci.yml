name: CI

on: push

jobs:
  pre:
    timeout-minutes: 20
    runs-on: windows-2019
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Add New Package Source
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: source add --name='repo' --source='./nupkgs/' --priority='1'
  test:
    runs-on: windows-2019
    strategy:
      max-parallel: 10
      fail-fast: false
      matrix:
        packages:
          [
            '7tt',
            'action',
            'betterdiscord',
            blitz.gg',
            'betterdiscord',
            'dcforoffice',
            'jarfix.portable',
            'leagueoflegendseune',
            'nvm.install',
            'onefetch',
            'portmaster',
            'tree-sitter',
          ]
    needs: pre
    steps:
      - name: Test Package
        uses: kamack38/chocopkgs/.github/workflows/_test-package.yml@master
        with:
          package-name: ${{ matrix.packages }}
